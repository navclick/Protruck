/*
Deployment script for ProTruck

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "ProTruck"
:setvar DefaultFilePrefix "ProTruck"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SQLEXPRESS\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SQLEXPRESS\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key ca7111ca-4942-480d-a13d-80da72a20187 is skipped, element [dbo].[Dorder].[AdressEng] (SqlSimpleColumn) will not be renamed to AddressEng';


GO
PRINT N'Rename refactoring operation with key 5f8147a8-f09d-49f5-bc4a-8d5a0e533c89 is skipped, element [dbo].[Dorder].[A] (SqlSimpleColumn) will not be renamed to AddressUrd';


GO
PRINT N'Rename refactoring operation with key 78b433a5-633d-4007-8e16-6ed9bf4f0a06 is skipped, element [dbo].[Dorder].[ContractNumber] (SqlSimpleColumn) will not be renamed to ContractType';


GO
PRINT N'Creating [dbo].[Dorder]...';


GO
CREATE TABLE [dbo].[Dorder] (
    [Id]             INT            IDENTITY (1, 1) NOT NULL,
    [DoNumber]       NUMERIC (18)   NULL,
    [ContractNumber] NUMERIC (18)   NULL,
    [ContractType]   INT            NULL,
    [QTY]            INT            NULL,
    [GoodsType]      INT            NULL,
    [AddressEng]     NVARCHAR (MAX) NULL,
    [AddressUrd]     NVARCHAR (MAX) NULL,
    [CityID]         INT            NULL,
    [Party]          INT            NULL,
    [Weight]         FLOAT (53)     NULL,
    [Unit]           INT            NULL,
    [Attached]       NUMERIC (18)   NULL,
    [DoDate]         DATE           NULL,
    [CreatedOn]      DATE           NULL,
    [EcomID]         INT            NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[FK_Dorder_ContractType]...';


GO
ALTER TABLE [dbo].[Dorder] WITH NOCHECK
    ADD CONSTRAINT [FK_Dorder_ContractType] FOREIGN KEY ([ContractType]) REFERENCES [dbo].[ContractType] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Dorder_GoodsTypes]...';


GO
ALTER TABLE [dbo].[Dorder] WITH NOCHECK
    ADD CONSTRAINT [FK_Dorder_GoodsTypes] FOREIGN KEY ([GoodsType]) REFERENCES [dbo].[GoodsTypes] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Dorder_Cities]...';


GO
ALTER TABLE [dbo].[Dorder] WITH NOCHECK
    ADD CONSTRAINT [FK_Dorder_Cities] FOREIGN KEY ([CityID]) REFERENCES [dbo].[Cities] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Dorder_Party]...';


GO
ALTER TABLE [dbo].[Dorder] WITH NOCHECK
    ADD CONSTRAINT [FK_Dorder_Party] FOREIGN KEY ([Party]) REFERENCES [dbo].[Party] ([Id]);


GO
-- Refactoring step to update target server with deployed transaction logs
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'ca7111ca-4942-480d-a13d-80da72a20187')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('ca7111ca-4942-480d-a13d-80da72a20187')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '5f8147a8-f09d-49f5-bc4a-8d5a0e533c89')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('5f8147a8-f09d-49f5-bc4a-8d5a0e533c89')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '78b433a5-633d-4007-8e16-6ed9bf4f0a06')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('78b433a5-633d-4007-8e16-6ed9bf4f0a06')

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[Dorder] WITH CHECK CHECK CONSTRAINT [FK_Dorder_ContractType];

ALTER TABLE [dbo].[Dorder] WITH CHECK CHECK CONSTRAINT [FK_Dorder_GoodsTypes];

ALTER TABLE [dbo].[Dorder] WITH CHECK CHECK CONSTRAINT [FK_Dorder_Cities];

ALTER TABLE [dbo].[Dorder] WITH CHECK CHECK CONSTRAINT [FK_Dorder_Party];


GO
PRINT N'Update complete.';


GO
