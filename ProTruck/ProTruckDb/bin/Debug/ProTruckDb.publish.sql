/*
Deployment script for ProTruck

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "ProTruck"
:setvar DefaultFilePrefix "ProTruck"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SQLEXPRESS\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL13.SQLEXPRESS\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY FULL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
USE [$(DatabaseName)];


GO
PRINT N'Rename refactoring operation with key 67ec3b83-6c36-45ce-89f2-66dcadc629d9 is skipped, element [dbo].[Users].[EmailC] (SqlSimpleColumn) will not be renamed to EmailConfirmed';


GO
PRINT N'Rename refactoring operation with key 3a1e16b9-e091-46f5-9509-a1ea94910ead is skipped, element [dbo].[ExanaduCompanies].[Expairy] (SqlSimpleColumn) will not be renamed to ExpiryDate';


GO
PRINT N'Rename refactoring operation with key 78b09d61-c183-434e-a6cd-abb63ef1e7d5 is skipped, element [dbo].[Modules].[Contr] (SqlSimpleColumn) will not be renamed to Controller';


GO
PRINT N'Rename refactoring operation with key da29891f-0cea-4a03-b7f4-6ca6a21bfb7e is skipped, element [dbo].[Users].[EcomID] (SqlSimpleColumn) will not be renamed to RoleID';


GO
PRINT N'Creating [ProTrukRepo]...';


GO
CREATE ASSEMBLY [ProTrukRepo]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103006CD90C5D0000000000000000E00022200B013000000C00000006000000000000762B0000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000242B00004F000000004000008803000000000000000000000000000000000000006000000C000000EC2900001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E746578740000007C0B000000200000000C000000020000000000000000000000000000200000602E72737263000000880300000040000000040000000E0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001200000000000000000000000000004000004200000000000000000000000000000000582B0000000000004800000002000500B82000003409000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002202281500000A002A000000133001000B00000001000011007E010000040A2B00062A00133002001600000002000011000272010000706F1600000A741A0000010A2B00062A2202281700000A002A567304000006281800000A740300000280010000042A00000042534A4201000100000000000C00000076342E302E33303331390000000005006C000000D0020000237E00003C030000B003000023537472696E677300000000EC060000280000002355530014070000100000002347554944000000240700001002000023426C6F6200000000000000020000015714A2010900000000FA013300160000010000001A0000000300000001000000050000001800000014000000020000000100000002000000020000000100000002000000000094020100000000000600D90155030600460255030600B60023030F00750300000600DE00C9020600BC01C90206009D01C90206002D02C9020600F901C90206001202C90206004C01C9020600CA00360306007400360306008001C90206006701640206009B03AD020600590055030A008200FE020A004100B4020A001201B4020600990023030A008502B4020A003401B4020A00F500B4020A004C00B40206007E02AD020000000012000000000001000100010010000B00F20241000100010000011000010084034D000100020011003100440050200000000086181603060001005C20000000009608A203480001007420000000008608DB024D00010096200000000086181603060001009F200000000091181C0351000100090016030100110016030600190016030A00290016031000310016031000390016031000410016031000490016031000510016031000590016031000610016031500690016031000710016031000790016031000890016030600910016031A00A10016030600A90016030600B90016032000C10016031000810016030600C900A4022F00990016030600C900240034002E000B005E002E00130067002E001B0086002E0023008F002E002B00A0002E003300A0002E003B00A0002E0043008F002E004B00A6002E005300A0002E005B00A0002E006300BE002E006B00E8002E007300F50049008B00430149009300430149009B00A2014900A300AB0163007B00430163008300480126002B00030001000000A60355000000DF025A00020002000300020003000500048000000100000000000000000000000000F20200000400000000000000000000003B001B00000000000400000000000000000000003B00AD020000000000000053657474696E67733100436C61737331003C4D6F64756C653E006D73636F726C69620053796E6368726F6E697A65640064656661756C74496E7374616E6365004170706C69636174696F6E53657474696E67734261736500436F6D70696C657247656E65726174656441747472696275746500477569644174747269627574650047656E657261746564436F64654174747269627574650044656275676765724E6F6E55736572436F64654174747269627574650044656275676761626C6541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C795469746C654174747269627574650044656661756C7453657474696E6756616C7565417474726962757465004170706C69636174696F6E53636F70656453657474696E67417474726962757465005370656369616C53657474696E6741747472696275746500417373656D626C7954726164656D61726B417474726962757465005461726765744672616D65776F726B41747472696275746500417373656D626C7946696C6556657273696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C794465736372697074696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E7341747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C79436F6D70616E794174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053797374656D2E52756E74696D652E56657273696F6E696E6700537472696E67005370656369616C53657474696E670050726F5472756B5265706F2E646C6C006765745F4974656D0053797374656D0053797374656D2E436F6E66696775726174696F6E0053797374656D2E5265666C656374696F6E006765745F50726F547275636B436F6E6E656374696F6E0050726F5472756B5265706F0053797374656D2E436F6465446F6D2E436F6D70696C6572002E63746F72002E6363746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E496E7465726F7053657276696365730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730050726F5472756B5265706F2E50726F70657274696573004F626A656374006765745F44656661756C740000000025500072006F0054007200750063006B0043006F006E006E0065006300740069006F006E00000068C81C6E6771074BA7B676FD32A1AA6D00042001010803200001052001011111042001010E0420010102052002010E0E052001011159040701120C0307010E0420011C0E0600011265126508B77A5C561934E0890306120C040000120C0320000E03000001040800120C0328000E0801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000701000000001001000B50726F5472756B5265706F000005010000000017010012436F7079726967687420C2A920203230313900002901002466326463626535342D373364662D343163392D623736612D36666330313733333762616500000C010007312E302E302E3000004D01001C2E4E45544672616D65776F726B2C56657273696F6E3D76342E352E320100540E144672616D65776F726B446973706C61794E616D65142E4E4554204672616D65776F726B20342E352E3204010000005901004B4D6963726F736F66742E56697375616C53747564696F2E456469746F72732E53657474696E677344657369676E65722E53657474696E677353696E676C6546696C6547656E657261746F720831352E302E312E3000000801000000000000006101005C4461746120536F757263653D4445534B544F502D4D4B55483343315C53514C455850524553533B496E697469616C20436174616C6F673D50726F547275636B3B557365722049443D73613B50617373776F72643D617361643132333B0000000000000000006BD90C5D00000000020000001C010000082A0000080C000052534453B47E98729DE49A4080D49958EDC7F67201000000463A5C50726F6A6563745C56535C50726F5472756B5C50726F547275636B5C50726F5472756B5265706F5C6F626A5C44656275675C50726F5472756B5265706F2E7064620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004C2B00000000000000000000662B0000002000000000000000000000000000000000000000000000582B0000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000002C03000000000000000000002C0334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001000000000000000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B0048C020000010053007400720069006E006700460069006C00650049006E0066006F0000006802000001003000300030003000300034006200300000001A000100010043006F006D006D0065006E007400730000000000000022000100010043006F006D00700061006E0079004E0061006D006500000000000000000040000C000100460069006C0065004400650073006300720069007000740069006F006E0000000000500072006F005400720075006B005200650070006F000000300008000100460069006C006500560065007200730069006F006E000000000031002E0030002E0030002E003000000040001000010049006E007400650072006E0061006C004E0061006D0065000000500072006F005400720075006B005200650070006F002E0064006C006C0000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020002000320030003100390000002A00010001004C006500670061006C00540072006100640065006D00610072006B00730000000000000000004800100001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000500072006F005400720075006B005200650070006F002E0064006C006C00000038000C000100500072006F0064007500630074004E0061006D00650000000000500072006F005400720075006B005200650070006F000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0030002E003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000783B00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating [dbo].[ExanaduCompanies]...';


GO
CREATE TABLE [dbo].[ExanaduCompanies] (
    [Id]                  INT            IDENTITY (1, 1) NOT NULL,
    [ClientName]          NVARCHAR (500) NULL,
    [ClientEmail]         NCHAR (100)    NULL,
    [ClientContactPeson]  NCHAR (100)    NULL,
    [ClientContactNumber] NCHAR (100)    NULL,
    [ClientAddress]       NCHAR (200)    NULL,
    [StartDate]           DATE           NULL,
    [ExpiryDate]          DATE           NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[LinkRoleMenus]...';


GO
CREATE TABLE [dbo].[LinkRoleMenus] (
    [Id]     INT IDENTITY (1, 1) NOT NULL,
    [RoleID] INT NULL,
    [MenuID] INT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[Menus]...';


GO
CREATE TABLE [dbo].[Menus] (
    [Id]         INT         IDENTITY (1, 1) NOT NULL,
    [Name]       NCHAR (100) NULL,
    [Controller] NCHAR (100) NULL,
    [Action]     NCHAR (100) NULL,
    [Icon]       NCHAR (200) NULL,
    [IsActive]   NCHAR (10)  NULL,
    [ModuleID]   INT         NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[Modules]...';


GO
CREATE TABLE [dbo].[Modules] (
    [Id]         INT         IDENTITY (1, 1) NOT NULL,
    [Name]       NCHAR (200) NULL,
    [Controller] NCHAR (100) NULL,
    [Action]     NCHAR (100) NULL,
    [IsActive]   BIT         NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[Roles]...';


GO
CREATE TABLE [dbo].[Roles] (
    [Id]        INT         IDENTITY (1, 1) NOT NULL,
    [Role]      NCHAR (100) NULL,
    [Desc]      NCHAR (500) NULL,
    [CreatedOn] DATE        NULL,
    [CreatedBy] INT         NULL,
    [EcomID]    INT         NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[Users]...';


GO
CREATE TABLE [dbo].[Users] (
    [Id]              INT            IDENTITY (1, 1) NOT NULL,
    [FullName]        NCHAR (100)    NULL,
    [Email]           NCHAR (100)    NULL,
    [Password]        NVARCHAR (MAX) NULL,
    [Phone]           NCHAR (100)    NULL,
    [EmailVeringCode] NVARCHAR (MAX) NULL,
    [EmailConfirmed]  BIT            NULL,
    [AccountStatus]   INT            NULL,
    [CreatedOn]       NCHAR (10)     NULL,
    [RoleID]          INT            NULL,
    [EcomID]          INT            NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[FK_LinkRoleMenus_Roles]...';


GO
ALTER TABLE [dbo].[LinkRoleMenus] WITH NOCHECK
    ADD CONSTRAINT [FK_LinkRoleMenus_Roles] FOREIGN KEY ([RoleID]) REFERENCES [dbo].[Roles] ([Id]);


GO
PRINT N'Creating [dbo].[FK_LinkRoleMenus_Menus]...';


GO
ALTER TABLE [dbo].[LinkRoleMenus] WITH NOCHECK
    ADD CONSTRAINT [FK_LinkRoleMenus_Menus] FOREIGN KEY ([MenuID]) REFERENCES [dbo].[Menus] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Menus_Modules]...';


GO
ALTER TABLE [dbo].[Menus] WITH NOCHECK
    ADD CONSTRAINT [FK_Menus_Modules] FOREIGN KEY ([ModuleID]) REFERENCES [dbo].[Modules] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Roles_ExanaduCompanies]...';


GO
ALTER TABLE [dbo].[Roles] WITH NOCHECK
    ADD CONSTRAINT [FK_Roles_ExanaduCompanies] FOREIGN KEY ([EcomID]) REFERENCES [dbo].[ExanaduCompanies] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Roles_Users]...';


GO
ALTER TABLE [dbo].[Roles] WITH NOCHECK
    ADD CONSTRAINT [FK_Roles_Users] FOREIGN KEY ([CreatedBy]) REFERENCES [dbo].[Users] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Users_ExanaduCompanies]...';


GO
ALTER TABLE [dbo].[Users] WITH NOCHECK
    ADD CONSTRAINT [FK_Users_ExanaduCompanies] FOREIGN KEY ([EcomID]) REFERENCES [dbo].[ExanaduCompanies] ([Id]);


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '67ec3b83-6c36-45ce-89f2-66dcadc629d9')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('67ec3b83-6c36-45ce-89f2-66dcadc629d9')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '3a1e16b9-e091-46f5-9509-a1ea94910ead')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('3a1e16b9-e091-46f5-9509-a1ea94910ead')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '78b09d61-c183-434e-a6cd-abb63ef1e7d5')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('78b09d61-c183-434e-a6cd-abb63ef1e7d5')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'da29891f-0cea-4a03-b7f4-6ca6a21bfb7e')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('da29891f-0cea-4a03-b7f4-6ca6a21bfb7e')

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[LinkRoleMenus] WITH CHECK CHECK CONSTRAINT [FK_LinkRoleMenus_Roles];

ALTER TABLE [dbo].[LinkRoleMenus] WITH CHECK CHECK CONSTRAINT [FK_LinkRoleMenus_Menus];

ALTER TABLE [dbo].[Menus] WITH CHECK CHECK CONSTRAINT [FK_Menus_Modules];

ALTER TABLE [dbo].[Roles] WITH CHECK CHECK CONSTRAINT [FK_Roles_ExanaduCompanies];

ALTER TABLE [dbo].[Roles] WITH CHECK CHECK CONSTRAINT [FK_Roles_Users];

ALTER TABLE [dbo].[Users] WITH CHECK CHECK CONSTRAINT [FK_Users_ExanaduCompanies];


GO
PRINT N'Update complete.';


GO
